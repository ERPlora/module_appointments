{% extends "ui/module_content.html" %}
{% load static i18n ui %}

{% block content %}
{# Stats Cards Grid #}
<div class="ui-grid ui-grid--stats mb-lg">
    {% ui_stat_card value=stats.total label=_("Total Appointments") icon="calendar-outline" color="primary" %}
    {% ui_stat_card value=stats.completed label=_("Completed") icon="checkmark-circle-outline" color="success" %}
    {% ui_stat_card value=pending_count label=_("Pending") icon="time-outline" color="warning" %}
    {% ui_stat_card value=stats.revenue|floatformat:2 label=_("Revenue") icon="cash-outline" color="success" %}
</div>

{# Today's Appointments #}
{% ui_card css_class="mb-lg" %}
    <div class="d-flex justify-between align-center mb-md">
        <div class="d-flex align-center gap-sm">
            <ion-icon name="today-outline" color="primary"></ion-icon>
            <span class="fw-semibold fs-lg">{% trans "Today's Appointments" %}</span>
        </div>
        {% ui_button label=_("View Calendar") fill="clear" size="small" icon="calendar-outline" icon_slot="end" hx_get="/modules/appointments/calendar/" hx_target="#main-content-area" hx_push_url=True %}
    </div>

    {% if today_appointments %}
    {% ui_list lines="full" %}
        {% for appointment in today_appointments %}
        <ion-item href="{% url 'appointments:appointment_detail' appointment.id %}" detail>
            <ion-icon name="person-circle-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
                <h2>{{ appointment.customer_name }}</h2>
                <p>{{ appointment.service_name }} - {{ appointment.start_datetime|time:"H:i" }}</p>
            </ion-label>
            <ion-badge slot="end" color="{% if appointment.status == 'confirmed' %}primary{% elif appointment.status == 'pending' %}warning{% elif appointment.status == 'completed' %}success{% else %}medium{% endif %}">
                {{ appointment.get_status_display }}
            </ion-badge>
        </ion-item>
        {% endfor %}
    {% endui_list %}
    {% else %}
    {% ui_empty_state title=_("No appointments today") icon="calendar-outline" %}
    {% endif %}
{% endui_card %}

{# Upcoming Appointments #}
{% ui_card css_class="mb-lg" %}
    <div class="d-flex justify-between align-center mb-md">
        <div class="d-flex align-center gap-sm">
            <ion-icon name="arrow-forward-outline" color="primary"></ion-icon>
            <span class="fw-semibold">{% trans "Upcoming Appointments" %}</span>
        </div>
        {% ui_button label=_("View All") fill="clear" size="small" icon="list-outline" icon_slot="end" hx_get="/modules/appointments/appointments/" hx_target="#main-content-area" hx_push_url=True %}
    </div>

    {% if upcoming_appointments %}
    {% ui_list lines="full" %}
        {% for appointment in upcoming_appointments %}
        <ion-item href="{% url 'appointments:appointment_detail' appointment.id %}" detail>
            <div slot="start" class="d-flex flex-column align-center p-xs rounded" style="background: var(--bg-color-secondary); min-width: 50px;">
                <span class="fs-xs text-secondary">{{ appointment.start_datetime|date:"D" }}</span>
                <span class="fw-bold">{{ appointment.start_datetime|date:"d" }}</span>
            </div>
            <ion-label class="ml-sm">
                <h2>{{ appointment.customer_name }}</h2>
                <p>{{ appointment.service_name }} - {{ appointment.start_datetime|time:"H:i" }}</p>
            </ion-label>
            <ion-badge slot="end" color="{% if appointment.status == 'confirmed' %}primary{% elif appointment.status == 'pending' %}warning{% else %}medium{% endif %}">
                {{ appointment.get_status_display }}
            </ion-badge>
        </ion-item>
        {% endfor %}
    {% endui_list %}
    {% else %}
    {% ui_empty_state title=_("No upcoming appointments") icon="calendar-outline" %}
    {% endif %}
{% endui_card %}

{# Quick Stats #}
{% ui_card %}
    <div class="d-flex justify-between align-center mb-md">
        <span class="fw-semibold">{% trans "This Month" %}</span>
    </div>
    <div class="ui-grid ui-grid--3 gap-md">
        <div class="text-center p-md rounded-lg" style="background: var(--bg-color-secondary);">
            <div class="fs-xl fw-bold text-success">{{ stats.completion_rate|floatformat:0 }}%</div>
            <div class="fs-sm text-secondary">{% trans "Completion Rate" %}</div>
        </div>
        <div class="text-center p-md rounded-lg" style="background: var(--bg-color-secondary);">
            <div class="fs-xl fw-bold text-warning">{{ stats.cancellation_rate|floatformat:0 }}%</div>
            <div class="fs-sm text-secondary">{% trans "Cancellation Rate" %}</div>
        </div>
        <div class="text-center p-md rounded-lg" style="background: var(--bg-color-secondary);">
            <div class="fs-xl fw-bold text-danger">{{ stats.no_show_rate|floatformat:0 }}%</div>
            <div class="fs-sm text-secondary">{% trans "No-Show Rate" %}</div>
        </div>
    </div>
{% endui_card %}
{% endblock %}
